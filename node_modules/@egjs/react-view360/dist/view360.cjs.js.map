{"version":3,"file":"view360.cjs.js","sources":["../src/consts.ts","../src/PanoViewer.tsx","../src/index.umd.ts"],"sourcesContent":["/*\n * Copyright (c) 2017 NAVER Corp.\n * egjs projects are licensed under the MIT license\n */\nimport { PanoViewerProps, SpinViewerProps } from \"./types\";\n\nexport const PANOVIEWER_DEFAULT_PROPS: PanoViewerProps = {\n  tag: \"div\",\n  onReady: () => {},\n  onViewChange: () => {},\n  onAnimationEnd: () => {},\n  onError: () => {}\n};\n\nexport const SPINVIEWER_DEFAULT_PROPS: SpinViewerProps = {\n  tag: \"div\",\n  onLoad: () => {},\n  onImageError: () => {},\n  onChange: () => {},\n  onAnimationEnd: () => {}\n};\n","/*\n * Copyright (c) 2017 NAVER Corp.\n * egjs projects are licensed under the MIT license\n */\nimport * as React from \"react\";\nimport {\n  PanoViewer as VanillaPanoViewer,\n  PanoViewerOptions,\n  withPanoViewerMethods,\n  PANOVIEWER_EVENTS,\n  PANOVIEWER_OPTIONS,\n  updatePanoViewer,\n  DEFAULT_CANVAS_CLASS\n} from \"@egjs/view360\";\n\nimport { PANOVIEWER_DEFAULT_PROPS } from \"./consts\";\nimport { PanoViewerProps } from \"./types\";\n\ntype PanoViewerPropsAndOptions = Partial<PanoViewerProps & PanoViewerOptions>;\n\nclass PanoViewer extends React.PureComponent<PanoViewerPropsAndOptions> {\n  public static defaultProps: PanoViewerProps = PANOVIEWER_DEFAULT_PROPS;\n\n  @withPanoViewerMethods private _vanillaPanoViewer: VanillaPanoViewer;\n  private _containerEl: HTMLElement;\n  private _prevProps: Partial<PanoViewerProps & PanoViewerOptions>;\n  private _canvasKey: number;\n\n  public get element() { return this._containerEl; }\n\n  public constructor(props: PanoViewerPropsAndOptions) {\n    super(props);\n\n    this._canvasKey = -1;\n  }\n\n  public componentDidMount() {\n    const props = { ...this.props };\n\n    this._vanillaPanoViewer = new VanillaPanoViewer(\n      this._containerEl,\n      props\n    );\n    this._prevProps = props;\n\n    this._bindEvents();\n  }\n\n  public componentWillUnmount() {\n    this._vanillaPanoViewer.destroy();\n  }\n\n  public componentWillUpdate(nextProps: PanoViewerPropsAndOptions) {\n    const props = this.props;\n\n    if ((nextProps.image != null && nextProps.image !== props.image)\n      || (nextProps.video != null && nextProps.video !== props.video)) {\n      // Re-generate canvas\n      this._canvasKey = this._generateCanvasKey();\n    }\n  }\n\n  public componentDidUpdate() {\n    const props = this.props;\n    const lastProps = this._prevProps;\n    const panoViewer = this._vanillaPanoViewer;\n\n    updatePanoViewer(panoViewer, props, lastProps);\n\n    this._prevProps = { ...props };\n  }\n\n  public render() {\n    const props = this.props;\n    const Container = props.tag as any;\n    const canvasClass = props.canvasClass ?? DEFAULT_CANVAS_CLASS;\n    const attributes: { [key: string]: any } = {};\n\n    for (const name in props) {\n      if (!(name in PANOVIEWER_DEFAULT_PROPS) && !(name in PANOVIEWER_OPTIONS)) {\n        attributes[name] = props[name];\n      }\n    }\n\n    return <Container {...attributes} ref={(e?: HTMLElement) => {\n      e && (this._containerEl = e);\n    }}>\n      <canvas className={canvasClass} key={this._canvasKey} />\n      { this.props.children }\n    </Container>;\n  }\n\n  private _bindEvents() {\n    const panoViewer = this._vanillaPanoViewer;\n    const props = this.props as Required<PanoViewerProps>;\n\n    Object.keys(PANOVIEWER_EVENTS).forEach((eventKey: keyof typeof PANOVIEWER_EVENTS) => {\n      const eventName = PANOVIEWER_EVENTS[eventKey];\n      const propName = `on${eventName.charAt(0).toUpperCase() + eventName.slice(1)}`;\n\n      panoViewer.on(eventName, e => {\n        e.currentTarget = this;\n\n        props[propName](e);\n      });\n    });\n  }\n\n  private _generateCanvasKey() {\n    let newKey: number;\n    const oldKey = this._canvasKey;\n\n    do {\n      const array = new Uint32Array(1);\n      crypto.getRandomValues(array);\n      newKey = array[0];\n    } while (newKey === oldKey);\n\n    return newKey;\n  }\n}\n\ninterface PanoViewer extends React.Component<Partial<PanoViewerProps & PanoViewerOptions>>, VanillaPanoViewer { }\nexport default PanoViewer;\n","/*\n * Copyright (c) 2017 NAVER Corp.\n * egjs projects are licensed under the MIT license\n */\nimport PanoViewer from \"./PanoViewer\";\nimport SpinViewer from \"./PanoViewer\";\n\nconst View360 = {\n  PanoViewer,\n  SpinViewer\n}\n\nexport default View360;\n"],"names":["PANOVIEWER_DEFAULT_PROPS","tag","onReady","onViewChange","onAnimationEnd","onError","__extends","props","_super","_this","_canvasKey","Object","_containerEl","_vanillaPanoViewer","VanillaPanoViewer","_prevProps","_bindEvents","destroy","nextProps","image","video","_generateCanvasKey","lastProps","panoViewer","updatePanoViewer","Container","canvasClass","DEFAULT_CANVAS_CLASS","attributes","name","PANOVIEWER_OPTIONS","React","ref","e","className","key","children","keys","PANOVIEWER_EVENTS","forEach","eventKey","eventName","propName","charAt","toUpperCase","slice","on","currentTarget","newKey","oldKey","array","Uint32Array","crypto","getRandomValues","PanoViewer","__decorate","withPanoViewerMethods","PureComponent","View360","SpinViewer"],"mappings":"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"}